{:paths ["bb"]
 :deps  {tick/tick           {:mvn/version "1.0"}
         russmatney/org-crud {:git/url "https://github.com/russmatney/org-crud"
                              :git/sha "b7ac5818b57378427b7bbc8ad865acd398edabe7"}
         org.babashka/json   {:mvn/version "0.1.6"}}
 :tasks
 {:requires ([babashka.fs :as fs]
             [clojure.edn :as edn]
             [blog.tasks :as tasks]
             )
  :init
  (do
    (defn log [& args]
      (apply println args))

    (defn shelll [& args]
      (apply println args)
      (apply shell args)))

  ;; === Astro/Starlight Commands ===

  dev
  (do
    (log "Starting Astro dev server...")
    (shelll "npm run dev"))

  build
  (do
    (log "Building Astro site...")
    (shelll "npm run build"))

  preview
  (do
    (log "Previewing built site...")
    (shelll "npm run preview"))

  serve
  (do
    (log "Alias for dev...")
    (shelll "npm run dev"))

  watch
  (do
    (log "Alias for dev (with nREPL suggestion)...")
    (when true #_osx?
          (println "you might want to 'bb --nrepl-server 1667'"))
    (shelll "npm run dev"))

  ;; === Migration Utilities ===

  migrate-frontmatter
  (do
    (log "Migrating frontmatter...")
    (require '[blog.migrate :as m])
    (m/migrate-all-posts))

  copy-to-astro
  (do
    (log "Copying content to Astro...")
    (require '[blog.copy-to-astro :as c])
    (c/copy-all-content)
    (c/copy-assets))

  ;; === DEPRECATED: Old Docsify Commands ===

  build-old
  (do
    (log "⚠️  DEPRECATED: This was for Docsify page generation")
    (log "The blog now uses Astro/Starlight")
    (log "Use 'bb build' to build the Astro site")
    (tasks/regen-all-pages))

  serve-old
  (do
    (log "⚠️  DEPRECATED: This was for Docsify")
    (log "Use 'bb dev' for Astro dev server")
    (shelll "docsify serve docs"))
  }}
